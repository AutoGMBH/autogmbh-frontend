<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Edito Veturën</title>
  <link rel="stylesheet" href="../style.css" />
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: 'Montserrat', sans-serif;
      padding: 2rem;
    }

    h1 {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    form {
      max-width: 600px;
      margin: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    label {
      font-weight: bold;
    }

    input, select, textarea, button {
      padding: 0.7rem;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
    }

    button {
      background-color: #28a745;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #218838;
    }

    #message {
      text-align: center;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Edito Veturën</h1>
    <form id="editCarForm">
      <label for="brand">Marka:</label>
      <select id="brand" name="brand" required></select>

      <label for="model">Modeli:</label>
      <select id="model" name="model" required></select>

      <label for="year">Viti:</label>
      <input type="number" id="year" name="year" required>

      <label for="price">Çmimi (€):</label>
      <input type="number" id="price" name="price" required>

      <label for="image">Link i fotos kryesore:</label>
      <input type="text" id="image" name="image" required>

      <label for="images">Foto tjera (URL, të ndara me presje):</label>
      <input type="text" id="images" name="images">

      <label for="description">Përshkrimi:</label>
      <textarea id="description" name="description" required></textarea>

      <button type="submit">Ruaj Ndryshimet</button>
    </form>
    <p id="message"></p>
  </div>

  <script>
    const brandModelData = {
      "BMW": ["1 Series", "2 Series", "3 Series", "4 Series", "5 Series", "6 Series", "7 Series", "8 Series", "X1", "X2", "X3", "X4", "X5", "X6", "X7", "M2", "M3", "M4", "M5", "M6", "Z3", "Z4"],
      "Mercedes": ["A-Class", "B-Class", "C-Class", "E-Class", "S-Class", "CLA", "CLS", "GLA", "GLB", "GLC", "GLE", "GLS", "G-Class", "Vito", "V-Class", "EQC", "Sprinter"],
      "Audi": ["A1", "A2", "A3", "A4", "A5", "A6", "A7", "A8", "Q2", "Q3", "Q5", "Q7", "Q8", "TT", "R8", "E-Tron"]
    };

    const brandSelect = document.getElementById('brand');
    const modelSelect = document.getElementById('model');

    Object.keys(brandModelData).forEach(brand => {
      const option = document.createElement('option');
      option.value = brand;
      option.textContent = brand;
      brandSelect.appendChild(option);
    });

    brandSelect.addEventListener('change', () => {
      const selectedBrand = brandSelect.value;
      const models = brandModelData[selectedBrand] || [];

      modelSelect.innerHTML = '';
      models.forEach(model => {
        const option = document.createElement('option');
        option.value = model;
        option.textContent = model;
        modelSelect.appendChild(option);
      });
    });

    const params = new URLSearchParams(window.location.search);
    const carId = params.get('id');

    fetch(`https://autogmbh-backend.onrender.com/api/search/${carId}`)
      .then(res => res.json())
      .then(data => {
        document.getElementById('brand').value = data.marka;
        brandSelect.dispatchEvent(new Event('change'));
        document.getElementById('model').value = data.modeli;
        document.getElementById('year').value = data.viti;
        document.getElementById('price').value = data.cmimi;
        document.getElementById('image').value = data.fotoKryesore;
        document.getElementById('images').value = data.fotoGaleria.join(', ');
        document.getElementById('description').value = data.pershkrimi;
      })
      .catch(err => {
        console.error(err);
        document.getElementById('message').textContent = 'Gabim gjatë ngarkimit të veturës.';
      });

    document.getElementById('editCarForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const updatedCar = {
        marka: brandSelect.value,
        modeli: modelSelect.value,
        viti: document.getElementById('year').value,
        cmimi: document.getElementById('price').value,
        fotoKryesore: document.getElementById('image').value,
        fotoGaleria: document.getElementById('images').value.split(',').map(i => i.trim()),
        pershkrimi: document.getElementById('description').value
      };

      try {
        const res = await fetch(`https://autogmbh-backend.onrender.com/api/edit-car/${carId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(updatedCar)
        });

        const result = await res.json();
        if (result.success) {
          document.getElementById('message').textContent = 'Veturë u përditësua me sukses!';
        } else {
          document.getElementById('message').textContent = 'Gabim gjatë përditësimit.';
        }
      } catch (err) {
        console.error(err);
        document.getElementById('message').textContent = 'Gabim gjatë lidhjes me serverin.';
      }
    });
  </script>
</body>
</html>
